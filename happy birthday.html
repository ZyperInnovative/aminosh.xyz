<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floating Containers - Manual Refresh</title>
    <style>
        
    </style>
</head>
<body>
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>
    
    <div class="control-panel">
        <h1>Floating Containers Control</h1>
        
        <div class="input-group">
            <label for="container-count">Number of Containers</label>
            <input type="number" id="container-count" min="1" max="10" value="3">
        </div>
        
        <div class="input-group">
            <label for="refresh-duration">Refresh Duration</label>
            <select id="refresh-duration">
                <option value="15">15 seconds</option>
                <option value="30" selected>30 seconds</option>
                <option value="50">50 seconds</option>
                <option value="60">60 seconds</option>
            </select>
        </div>
        
        <div id="link-inputs" class="link-inputs">
            <!-- Dynamic link inputs will be added here -->
        </div>
        
        <button id="confirm-btn" class="pulse">CONFIRM</button>
        
        <div class="refresh-controls">
            <button id="start-refresh-btn">START REFRESH</button>
            <button id="stop-refresh-btn">STOP REFRESH</button>
        </div>
    </div>
    
    <div id="container-display" class="container-display">
        <!-- Floating containers will be added here -->
    </div>
    
    <div class="fullscreen-controls" id="fullscreen-controls">
        <button id="refresh-fs-btn">REFRESH</button>
        <button id="exit-fs-btn" class="exit-fullscreen">EXIT FULLSCREEN</button>
    </div>
    
    <script>
        let currentFullscreenContainer = null;
        let refreshIntervals = [];
        let isRefreshing = false;
        
        document.getElementById('container-count').addEventListener('input', function() {
            const count = parseInt(this.value);
            const linkInputs = document.getElementById('link-inputs');
            
            if (count > 0) {
                linkInputs.style.display = 'block';
                linkInputs.innerHTML = '';
                
                for (let i = 0; i < count; i++) {
                    const div = document.createElement('div');
                    div.className = 'input-group';
                    div.innerHTML = `
                        <label for="link-${i}">Container ${i+1} URL</label>
                        <input type="url" id="link-${i}" placeholder="https://example.com" required>
                    `;
                    linkInputs.appendChild(div);
                }
            } else {
                linkInputs.style.display = 'none';
            }
        });
        
        document.getElementById('confirm-btn').addEventListener('click', function() {
            const count = parseInt(document.getElementById('container-count').value);
            const duration = parseInt(document.getElementById('refresh-duration').value);
            const containerDisplay = document.getElementById('container-display');
            
            // Clear existing containers and intervals
            containerDisplay.innerHTML = '';
            stopAllRefresh();
            
            // Create new containers
            for (let i = 0; i < count; i++) {
                const urlInput = document.getElementById(`link-${i}`);
                if (!urlInput || !urlInput.value) continue;
                
                createContainer(i, urlInput.value, duration);
            }
            
            // Reset refresh state
            isRefreshing = false;
            document.getElementById('start-refresh-btn').disabled = false;
            document.getElementById('stop-refresh-btn').disabled = true;
        });
        
        document.getElementById('start-refresh-btn').addEventListener('click', function() {
            if (!isRefreshing) {
                startAllRefresh();
                isRefreshing = true;
                this.disabled = true;
                document.getElementById('stop-refresh-btn').disabled = false;
            }
        });
        
        document.getElementById('stop-refresh-btn').addEventListener('click', function() {
            if (isRefreshing) {
                stopAllRefresh();
                isRefreshing = false;
                this.disabled = true;
                document.getElementById('start-refresh-btn').disabled = false;
            }
        });
        
        function stopAllRefresh() {
            refreshIntervals.forEach(interval => {
                clearInterval(interval);
            });
            refreshIntervals = [];
            
            // Update all indicators
            document.querySelectorAll('.refresh-indicator').forEach(indicator => {
                indicator.textContent = 'Refresh stopped';
            });
        }
        
        function startAllRefresh() {
            const duration = parseInt(document.getElementById('refresh-duration').value);
            
            document.querySelectorAll('.floating-container').forEach(container => {
                const iframe = container.querySelector('iframe');
                const indicator = container.querySelector('.refresh-indicator');
                
                refreshContainer(iframe, indicator, duration);
            });
        }
        
        function createContainer(index, url, duration) {
            const container = document.createElement('div');
            container.className = 'floating-container';
            container.dataset.index = index;
            container.innerHTML = `
                <div class="container-header">
                    <div class="container-title">Container ${index+1}</div>
                    <div class="container-controls">
                        <div class="control-btn expand-btn">+</div>
                        <div class="control-btn fullscreen-btn">⛶</div>
                        <div class="control-btn refresh-btn">↻</div>
                    </div>
                </div>
                <div class="container-content">
                    <iframe src="${url}"></iframe>
                    <div class="refresh-indicator">Refresh stopped</div>
                </div>
            `;
            
            document.getElementById('container-display').appendChild(container);
            
            // Add event listeners
            const header = container.querySelector('.container-header');
            const content = container.querySelector('.container-content');
            const refreshBtn = container.querySelector('.refresh-btn');
            const expandBtn = container.querySelector('.expand-btn');
            const fullscreenBtn = container.querySelector('.fullscreen-btn');
            const iframe = container.querySelector('iframe');
            const indicator = container.querySelector('.refresh-indicator');
            
            let isExpanded = true;
            
            function toggleExpand() {
                isExpanded = !isExpanded;
                if (isExpanded) {
                    content.classList.remove('collapsed');
                    expandBtn.textContent = '-';
                } else {
                    content.classList.add('collapsed');
                    expandBtn.textContent = '+';
                }
            }
            
            function manualRefresh() {
                const duration = parseInt(document.getElementById('refresh-duration').value);
                iframe.src = iframe.src;
                indicator.textContent = `Manually refreshed - auto refresh ${isRefreshing ? 'on' : 'off'}`;
                
                if (isRefreshing) {
                    // If auto-refresh is on, restart its timer
                    refreshContainer(iframe, indicator, duration);
                }
            }
            
            function enterFullscreen() {
                // Store current container
                currentFullscreenContainer = container;
                
                // Apply fullscreen classes
                container.classList.add('fullscreen');
                content.classList.add('fullscreen');
                
                // Show fullscreen controls
                document.getElementById('fullscreen-controls').style.display = 'flex';
                
                // Hide other containers
                document.querySelectorAll('.floating-container').forEach(c => {
                    if (c !== container) c.style.display = 'none';
                });
                
                // Hide control panel
                document.querySelector('.control-panel').style.display = 'none';
            }
            
            function exitFullscreen() {
                if (!currentFullscreenContainer) return;
                
                // Remove fullscreen classes
                currentFullscreenContainer.classList.remove('fullscreen');
                currentFullscreenContainer.querySelector('.container-content').classList.remove('fullscreen');
                
                // Hide fullscreen controls
                document.getElementById('fullscreen-controls').style.display = 'none';
                
                // Show other containers
                document.querySelectorAll('.floating-container').forEach(c => {
                    c.style.display = '';
                });
                
                // Show control panel
                document.querySelector('.control-panel').style.display = '';
                
                currentFullscreenContainer = null;
            }
            
            header.addEventListener('click', toggleExpand);
            expandBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleExpand();
            });
            
            fullscreenBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                enterFullscreen();
            });
            
            refreshBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                manualRefresh();
            });
            
            // Fullscreen control buttons
            document.getElementById('refresh-fs-btn').addEventListener('click', () => {
                if (currentFullscreenContainer) {
                    manualRefresh();
                }
            });
            
            document.getElementById('exit-fs-btn').addEventListener('click', exitFullscreen);
        }
        
        function refreshContainer(iframe, indicator, duration) {
            // Clear any existing interval for this container
            const existingIndex = refreshIntervals.findIndex(interval => 
                interval.element === iframe
            );
            
            if (existingIndex !== -1) {
                clearInterval(refreshIntervals[existingIndex].interval);
                refreshIntervals.splice(existingIndex, 1);
            }
            
            // Initial refresh
            iframe.src = iframe.src;
            let timeLeft = duration;
            indicator.textContent = `Refreshing in ${timeLeft}s`;
            
            // Set up new interval
            const interval = setInterval(() => {
                timeLeft--;
                indicator.textContent = `Refreshing in ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    iframe.src = iframe.src;
                    timeLeft = duration;
                }
            }, 1000);
            
            // Store the interval reference
            refreshIntervals.push({
                interval: interval,
                element: iframe
            });
        }
    </script>
</body>
</html>